{
  "hash": "9b89feb007122f98ebc3460a0aa750d8",
  "result": {
    "engine": "knitr",
    "markdown": "# Cross-Classified Models\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell collectcode='true'}\n\n:::\n\n\n## Introduction\n\nA two level multilevel model imagines that *Level 1* units are nested in *Level 2* units. A three level multilevel model imagines that *Level 1* units are nested in *Level 2* units, which are in turn nested in *Level 3* units. \n\nA cross-classified model imagines that the nesting is not hierarchical, but rather that there are two sets of clusters or nestings which overlap, but are not hierarchical. \n\n```{mermaid}\n%%| echo: false\n%%| eval: false\n\nflowchart LR\n    school1 --> student1\n    school1 --> student2\n    school1 --> student3\n    \n    school2 --> student4\n    school2 --> student5\n    school2 --> student6\n    \n```\n\n## Get Data\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nuse \"simulated_multilevel_longitudinal_data.dta\", clear\n\n```\n:::\n\n\n## Cross Classified Model\n\nWe can treat these random effects as being *cross classified*. \n\nThis might be useful if we had data where individuals lived in different countries at different times. \n\nHowever, because `id` is in fact nested inside `country`, in this case, estimating the random effects as cross classified will be more time consuming, but will give us equivalent results to a three level model.\n\n### Standard (Less Computationally Efficient) Syntax\n\nThe below syntax will take a very long time to run with the full sample, and thus we have commented it out.\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n    \n* mixed outcome t warmth physical_punishment || _all: R.country || _all: R.id\n\t\n* est store crossed1\n\n```\n:::\n\n\t\nThe documentation notes that we can use a *much* more computationally efficient version of the above command, which is what we do in these notes. The user can verify that both versions of the command will produce equivalent results.\n\nIn fact, at the end of handout we verify the similarity of both sets of syntax using a random sample.\n\n### Cross Classified With Computationally Efficient Syntax\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nmixed outcome t warmth physical_punishment || _all: R.country || id:\n\t\nest store crossed2 // store crossed effects result\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood = -28516.314  \nIteration 1:  Log likelihood = -28516.277  \nIteration 2:  Log likelihood = -28516.277  \n\nComputing standard errors ...\n\nMixed-effects ML regression                            Number of obs =   9,000\n\n        Grouping information\n        -------------------------------------------------------------\n                        |     No. of       Observations per group\n         Group variable |     groups    Minimum    Average    Maximum\n        ----------------+--------------------------------------------\n                   _all |          1      9,000    9,000.0      9,000\n                     id |      3,000          3        3.0          3\n        -------------------------------------------------------------\n\n                                                       Wald chi2(3)  = 1168.69\nLog likelihood = -28516.277                            Prob > chi2   =  0.0000\n\n------------------------------------------------------------------------------------\n           outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n-------------------+----------------------------------------------------------------\n                 t |   .9434605    .065866    14.32   0.000     .8143654    1.072556\n            warmth |   .9053924   .0380439    23.80   0.000     .8308277    .9799572\nphysical_punishm~t |  -1.014385   .0499354   -20.31   0.000    -1.112257    -.916514\n             _cons |    50.8301   .4123007   123.28   0.000       50.022    51.63819\n------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\n_all: Identity               |\n              var(R.country) |   3.429974    .930313      2.015668    5.836634\n-----------------------------+------------------------------------------------\nid: Identity                 |\n                  var(_cons) |   8.608872   .4757699      7.725107     9.59374\n-----------------------------+------------------------------------------------\n               var(Residual) |   26.02862   .4752444      25.11363    26.97695\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(2) = 1260.84               Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\n## Three Level Model\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nmixed outcome t warmth physical_punishment || country: || id:  // 3 level w/ random intercepts only\n\t\nest store threelevel // store random intercept model\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood = -28516.314  \nIteration 1:  Log likelihood = -28516.277  \nIteration 2:  Log likelihood = -28516.277  \n\nComputing standard errors ...\n\nMixed-effects ML regression                            Number of obs =   9,000\n\n        Grouping information\n        -------------------------------------------------------------\n                        |     No. of       Observations per group\n         Group variable |     groups    Minimum    Average    Maximum\n        ----------------+--------------------------------------------\n                country |         30        300      300.0        300\n                     id |      3,000          3        3.0          3\n        -------------------------------------------------------------\n\n                                                       Wald chi2(3)  = 1168.69\nLog likelihood = -28516.277                            Prob > chi2   =  0.0000\n\n------------------------------------------------------------------------------------\n           outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n-------------------+----------------------------------------------------------------\n                 t |   .9434605    .065866    14.32   0.000     .8143654    1.072556\n            warmth |   .9053924   .0380439    23.80   0.000     .8308277    .9799572\nphysical_punishm~t |  -1.014385   .0499354   -20.31   0.000    -1.112257    -.916514\n             _cons |    50.8301   .4123007   123.28   0.000       50.022    51.63819\n------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Identity            |\n                  var(_cons) |   3.429974    .930313      2.015668    5.836634\n-----------------------------+------------------------------------------------\nid: Identity                 |\n                  var(_cons) |   8.608872   .4757699      7.725107     9.59374\n-----------------------------+------------------------------------------------\n               var(Residual) |   26.02862   .4752444      25.11363    26.97695\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(2) = 1260.84               Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\t\n## Nice Table of Results of Three Level and Cross Classified Model\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\netable, estimates(threelevel crossed2), ///\nshowstars showstarsnote /// show stars and note\ncolumn(estimate) // column is modelname\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\ninvalid 'showstars' \nr(198);\n\nr(198);\n```\n\n\n:::\n:::\n\n\n## Verification of Syntax Equivalence for Cross Classified Model\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nkeep if family <= 5 // random sample of families\n\t\nquietly mixed outcome t warmth physical_punishment || _all: R.country || _all: R.id\n\t\nest store crossed1A // less efficient syntax\n\t\nquietly mixed outcome t warmth physical_punishment || _all: R.country || id:\n\t\nest store crossed2A // more efficient syntax\n\t\netable, estimates(crossed1A crossed2A) ///\nshowstars showstarsnote /// show stars and note\ncolumn(estimate) // column is modelname\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(8,550 observations deleted)\n\n\n\n\n\n\n------------------------------------------------------\n                                  crossed1A  crossed2A\n------------------------------------------------------\ntime                               0.745 **   0.745 **\n                                 (0.281)    (0.281)   \nparental warmth in past week       0.871 **   0.871 **\n                                 (0.160)    (0.160)   \nphysical punishment in past week  -1.262 **  -1.262 **\n                                 (0.206)    (0.206)   \nIntercept                         51.755 **  51.755 **\n                                 (1.009)    (1.009)   \nvar(R_country)                     2.245      2.245   \n                                 (1.319)    (1.319)   \nvar(R_id)                          5.425              \n                                 (1.843)              \nvar(e)                            23.638     23.638   \n                                 (1.933)    (1.933)   \nvar(_cons)                                    5.425   \n                                            (1.843)   \nNumber of observations               450        450   \n------------------------------------------------------\n** p<.01, * p<.05\n```\n\n\n:::\n:::\n\n\n## QUESTIONS??? \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}