{
  "hash": "2290d04a0e131f97948690ac3c352e62",
  "result": {
    "engine": "knitr",
    "markdown": "# Two Level Cross Sectional; And Three Level Longitudinal Models\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell collectcode='true'}\n\n:::\n\n\n\n# Cross Sectional Model\n\n## Get Data\n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nuse \"simulated_multilevel_data.dta\", clear\n\n```\n:::\n\n\n\n## The Equation\n\n$$\\text{outcome}_{ij} = \\beta_0 + \\beta_1 \\text{parental warmth} + \\beta_2 \\text{physical punishment} + \\beta_3 \\text{time} + $$ \n\n$$\\beta_4 \\text{identity}_2 + \\beta_5 \\text{intervention} + \\beta_6 HDI +$$\n\n$$u_{0j} + u_{1j} \\times \\text{parental warmth} + e_{ij} $$\n\n## Descriptive Statistics\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nsummarize // descriptive statistics\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Variable |        Obs        Mean    Std. dev.       Min        Max\n-------------+---------------------------------------------------------\n     country |      3,000        15.5    8.656884          1         30\n         HDI |      3,000    64.76667    17.24562         33         87\n      family |      3,000        50.5    28.87088          1        100\n          id |          0\n    identity |      3,000    .4976667    .5000779          0          1\n-------------+---------------------------------------------------------\nintervention |      3,000    .4843333    .4998378          0          1\nphysical_p~t |      3,000    2.478667    1.360942          0          5\n      warmth |      3,000    3.521667    1.888399          0          7\n     outcome |      3,000    52.43327    6.530996   29.60798   74.83553\n```\n\n\n:::\n:::\n\n\n\n## Spaghetti Plot\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\nspagplot outcome warmth, id(country) scheme(stcolor)\n\ngraph export spagplot1.png, width(1000) replace\n\n```\n:::\n\n\n\n![Spaghetti Plot of Outcome by Warmth by Country](spagplot1.png){width=50%}\n\n\n## Unconditional Model\n\n### Model\n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nmixed outcome || country: // unconditional model\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood = -9802.8371  \nIteration 1:  Log likelihood = -9802.8371  \n\nComputing standard errors ...\n\nMixed-effects ML regression                           Number of obs    = 3,000\nGroup variable: country                               Number of groups =    30\n                                                      Obs per group:\n                                                                   min =   100\n                                                                   avg = 100.0\n                                                                   max =   100\n                                                      Wald chi2(0)     =     .\nLog likelihood = -9802.8371                           Prob > chi2      =     .\n\n------------------------------------------------------------------------------\n     outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n       _cons |   52.43327   .3451217   151.93   0.000     51.75685     53.1097\n------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Identity            |\n                  var(_cons) |   3.178658   .9226737      1.799552    5.614658\n-----------------------------+------------------------------------------------\n               var(Residual) |   39.46106   1.024013      37.50421       41.52\n------------------------------------------------------------------------------\nLR test vs. linear model: chibar2(01) = 166.31        Prob >= chibar2 = 0.0000\n```\n\n\n:::\n:::\n\n\n\n### ICC\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nestat icc\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIntraclass correlation\n\n------------------------------------------------------------------------------\n                       Level |        ICC   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\n                     country |   .0745469   .0201254      .0434963    .1248696\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n\t\n## Full Model\n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nmixed outcome warmth physical_punishment identity i.intervention HDI || country: warmth // multilevel model\n\nest store crosssectional // store estimates\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood = -9626.6279  \nIteration 1:  Log likelihood =  -9626.607  \nIteration 2:  Log likelihood =  -9626.607  \n\nComputing standard errors ...\n\nMixed-effects ML regression                          Number of obs    =  3,000\nGroup variable: country                              Number of groups =     30\n                                                     Obs per group:\n                                                                  min =    100\n                                                                  avg =  100.0\n                                                                  max =    100\n                                                     Wald chi2(5)     = 334.14\nLog likelihood =  -9626.607                          Prob > chi2      = 0.0000\n\n-------------------------------------------------------------------------------------\n            outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n--------------------+----------------------------------------------------------------\n             warmth |   .8345368   .0637213    13.10   0.000     .7096453    .9594282\nphysical_punishment |  -.9916657   .0797906   -12.43   0.000    -1.148052   -.8352791\n           identity |  -.3004767   .2170295    -1.38   0.166    -.7258466    .1248933\n     1.intervention |   .6396427   .2174519     2.94   0.003     .2134448    1.065841\n                HDI |   -.003228   .0199257    -0.16   0.871    -.0422817    .0358256\n              _cons |   51.99991   1.371257    37.92   0.000      49.3123    54.68753\n-------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Independent         |\n                 var(warmth) |   .0227504   .0257784      .0024689    .2096436\n                  var(_cons) |   2.963975   .9737647      1.556777    5.643163\n-----------------------------+------------------------------------------------\n               var(Residual) |   34.97499   .9097109      33.23668    36.80422\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(2) = 205.74                Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\n\n# Longitudinal Model\n\n## Setup\n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nuse \"simulated_multilevel_longitudinal_data.dta\", clear\n\n```\n:::\n\n\n\n## The Equation\n\n$$\\text{outcome}_{ij} = \\beta_0 + \\beta_1 \\text{parental warmth} + \\beta_2 \\text{physical punishment} + \\beta_3 \\text{time} + $$ \n\n$$\\beta_4 \\text{identity}_2 + \\beta_5 \\text{intervention} + \\beta_5 HDI +$$\n\n$$u_{0j} + u_{1j} \\times \\text{parental warmth} + $$\n\n$$v_{0i} + v_{1i} \\times t + e_{ij} $$\n\n## Descriptive Statistics\n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nsummarize // descriptive statistics\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Variable |        Obs        Mean    Std. dev.       Min        Max\n-------------+---------------------------------------------------------\n     country |      9,000        15.5    8.655922          1         30\n         HDI |      9,000    64.76667     17.2437         33         87\n      family |      9,000        50.5    28.86767          1        100\n          id |          0\n    identity |      9,000    .4976667    .5000223          0          1\n-------------+---------------------------------------------------------\nintervention |      9,000    .4843333    .4997823          0          1\n           t |      9,000           2    .8165419          1          3\nphysical_p~t |      9,000    2.485333    1.373639          0          5\n      warmth |      9,000    3.514222      1.8839          0          7\n     outcome |      9,000    53.37768    6.572285   29.60798   79.02199\n```\n\n\n:::\n:::\n\n\n\n## Alternate Plot\n\n\n\n::: {.cell collectcode='false'}\n\n```{.stata .cell-code}\nencode id, generate(idNUMERIC) // numeric version of id\n\t\n* spagplot outcome t if idNUMERIC <= 10, id(idNUMERIC) scheme(stcolor)\n\t\ntwoway (lfit outcome t) (scatter outcome t) if idNUMERIC <= 10, by(idNUMERIC) scheme(stcolor)\n\ngraph export spagplot2.png, width(1000) replace\n\n```\n:::\n\n\n\n![Alternate Plot of Outcome by Time by Individual; First 10 Observations](spagplot2.png){width=50%}\n\n## Unconditional Model\n\n### Model\n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\nmixed outcome || country: || id: // unconditional model\n\n```\n:::\n\n\n\n### ICC\n\n\n\n::: {.cell collectcode='false'}\n\n```{.stata .cell-code}\n\nestat icc\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIntraclass correlation\n\n------------------------------------------------------------------------------\n                       Level |        ICC   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\n                     country |   .0748336   .0190847      .0450028    .1219141\n                  id|country |   .3462837   .0171461      .3134867    .3806097\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n\t\n## Full Model\t\n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nmixed outcome t warmth physical_punishment i.identity i.intervention HDI || country: warmth || id: t // multilevel model\n\nest store longitudinal // store estimates\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood =  -28523.49  \nIteration 1:  Log likelihood = -28499.987  \nIteration 2:  Log likelihood = -28499.739  \nIteration 3:  Log likelihood = -28499.604  \nIteration 4:  Log likelihood = -28499.603  \n\nComputing standard errors ...\n\nMixed-effects ML regression                            Number of obs =   9,000\n\n        Grouping information\n        -------------------------------------------------------------\n                        |     No. of       Observations per group\n         Group variable |     groups    Minimum    Average    Maximum\n        ----------------+--------------------------------------------\n                country |         30        300      300.0        300\n                     id |      3,000          3        3.0          3\n        -------------------------------------------------------------\n\n                                                       Wald chi2(6)  = 1096.15\nLog likelihood = -28499.603                            Prob > chi2   =  0.0000\n\n-------------------------------------------------------------------------------------\n            outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n--------------------+----------------------------------------------------------------\n                  t |    .943864   .0658716    14.33   0.000      .814758     1.07297\n             warmth |   .9134959   .0423732    21.56   0.000      .830446    .9965459\nphysical_punishment |  -1.007897   .0497622   -20.25   0.000    -1.105429   -.9103647\n         1.identity |  -.1276926   .1515835    -0.84   0.400    -.4247908    .1694057\n     1.intervention |   .8589966   .1519095     5.65   0.000     .5612596    1.156734\n                HDI |  -.0005657   .0196437    -0.03   0.977    -.0390666    .0379352\n              _cons |   50.46724   1.338318    37.71   0.000     47.84418    53.09029\n-------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Independent         |\n                 var(warmth) |   .0107586   .0127845      .0010478    .1104703\n                  var(_cons) |   3.167085   .9146761      1.798154    5.578181\n-----------------------------+------------------------------------------------\nid: Independent              |\n                      var(t) |   3.58e-09   7.06e-07      3.5e-177    3.7e+159\n                  var(_cons) |   8.387275   .4724188      7.510631    9.366242\n-----------------------------+------------------------------------------------\n               var(Residual) |   26.02733   .4753701      25.11211    26.97592\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(4) = 1247.03               Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\n\n# Nice Table of Results\n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nest table crosssectional longitudinal, ///\nb(%9.3f) star stats(N ll chi2) ///\nvarwidth(20) modelwidth(15)\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Variable |   crosssectional        longitudinal     \n---------------------+------------------------------------------\noutcome              |\n              warmth |           0.835***             0.913***  \n physical_punishment |          -0.992***            -1.008***  \n            identity |          -0.300                          \n                     |\n        intervention |\n                  1  |           0.640**              0.859***  \n                     |\n                 HDI |          -0.003               -0.001     \n                   t |                                0.944***  \n                     |\n            identity |\n                  1  |                               -0.128     \n                     |\n               _cons |          52.000***            50.467***  \n---------------------+------------------------------------------\nlns1_1_1             |\n               _cons |          -1.892***            -2.266***  \n---------------------+------------------------------------------\nlns1_1_2             |\n               _cons |           0.543***             0.576***  \n---------------------+------------------------------------------\nlnsig_e              |\n               _cons |           1.777***             1.630***  \n---------------------+------------------------------------------\nlns2_1_1             |\n               _cons |                               -9.724     \n---------------------+------------------------------------------\nlns2_1_2             |\n               _cons |                                1.063***  \n---------------------+------------------------------------------\nStatistics           |                                          \n                   N |            3000                 9000     \n                  ll |       -9626.607            -2.85e+04     \n                chi2 |         334.143             1096.148     \n----------------------------------------------------------------\n                        Legend: * p<0.05; ** p<0.01; *** p<0.001\n```\n\n\n:::\n:::\n\n\n\n# QUESTIONS??? {#majorsection}\n\n\n\n\n\n",
    "supporting": [
      "multilevel-workshop_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}